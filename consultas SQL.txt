--1- Devuelve todas las películas
SELECT MOVIE_NAME FROM MOVIES
--2- Devuelve todos los géneros existentes
SELECT GENRE_NAME FROM GENRES
--3- Devuelve la lista de todos los estudios de grabación que estén activos
SELECT STUDIO_ACTIVE FROM STUDIOS
--4- Devuelve una lista de los 20 últimos miembros en anotarse a la plataforma
SELECT*FROM USERS 
ORDER BY USER_SUBSCRIPTION_ID DESC 
LIMIT 20
--5- Devuelve las 20 duraciones de películas más frecuentes, ordenados de mayor a menor
SELECT MOVIE_DURATION, COUNT (*) AS FRECUENCY 
FROM MOVIES 
GROUP BY MOVIE_DURATION 
ORDER BY FRECUENCY DESC, MOVIE_DURATION DESC 
LIMIT 20;
--6- Devuelve las películas del año 2000 en adelante que empiecen por la letra A.
SELECT * 
FROM MOVIES 
WHERE YEAR (MOVIE_RELEASE_DATE) >=2000 
AND MOVIE_NAME LIKE 'A%'
--7- Devuelve los actores nacidos un mes de Junio
SELECT * 
FROM ACTORS 
WHERE MONTH (ACTOR_BIRTH_DATE) =06
--8- Devuelve los actores nacidos cualquier mes que no sea Junio y que sigan vivos
SELECT * 
FROM ACTORS 
WHERE MONTH (ACTOR_BIRTH_DATE) <> 06 
AND ACTOR_DEAD_DATE IS  NULL
--9- Devuelve el nombre y la edad de todos los directores menores o iguales de 50 años que estén vivos
SELECT director_name, 
YEAR(CURRENT_DATE) - YEAR(director_birth_date) AS AGE 
FROM DIRECTORS 
WHERE DIRECTOR_DEAD_DATE IS NULL 
AND (YEAR(CURRENT_DATE) - YEAR(DIRECTOR_BIRTH_DATE)) <= 50
--10- Devuelve el nombre y la edad de todos los actores menores de 50 años que hayan fallecido
SELECT DIRECTOR_NAME, 
YEAR (CURRENT_DATE) - YEAR (DIRECTOR_BIRTH_DATE) AS AGE 
FROM DIRECTORS 
WHERE DIRECTOR_DEAD_DATE IS NOT NULL 
AND (YEAR (CURRENT_DATE) - YEAR (DIRECTOR_BIRTH_DATE)) >=50;
--11- Devuelve el nombre de todos los directores menores o iguales de 40 años que estén vivos
SELECT DIRECTOR_NAME 
FROM DIRECTORS 
WHERE DIRECTOR_DEAD_DATE IS NULL 
AND (YEAR (CURRENT_DATE) - YEAR (DIRECTOR_BIRTH_DATE)) >=40
--12- Indica la edad media de los directores vivos
SELECT AVG (YEAR (CURRENT_DATE) - YEAR (DIRECTOR_BIRTH_DATE)) AS MIDDLE_AGE 
FROM DIRECTORS 
WHERE DIRECTOR_DEAD_DATE IS NULL
--13- Indica la edad media de los actores que han fallecido
SELECT AVG (YEAR (DIRECTOR_DEAD_DATE) - YEAR (DIRECTOR_BIRTH_DATE)) AS MIDDLE_AGE 
FROM DIRECTORS 
WHERE DIRECTOR_DEAD_DATE IS NOT NULL
--14- Devuelve el nombre de todas las películas y el nombre del estudio que las ha realizado
SELECT m.MOVIE_NAME, s.studio_name 
FROM MOVIES m 
JOIN STUDIOS S ON m.STUDIO_ID = s.STUDIO_ID
--15- Devuelve los miembros que accedieron al menos una película entre el año 2010 y el 2015
SELECT DISTINCT u.USER_NAME
FROM USERS u
JOIN USER_MOVIE_ACCESS ac ON u. USER_ID = ac.USER_ID
WHERE YEAR (ac.ACCESS_DATE) >= 2010 AND YEAR (ac.ACCESS_DATE) <=2015
--16- Devuelve cuantas películas hay de cada país
SELECT n.NATIONALITY_NAME, COUNT (*) AS TOTAL_MOVIES
FROM MOVIES m
JOIN NATIONALITIES n ON m.NATIONALITY_ID = n.NATIONALITY_ID
GROUP BY n.NATIONALITY_NAME
--17- Devuelve todas las películas que hay de género documental
SELECT m.MOVIE_NAME 
FROM MOVIES m 
JOIN GENRES g ON m.GENRE_ID = g.GENRE_ID  
WHERE g.GENRE_NAME = 'Documentary'
--18- Devuelve todas las películas creadas por directores nacidos a partir de 1980 y que todavía están vivos
SELECT m. MOVIE_NAME 
FROM MOVIES m 
JOIN DIRECTORS d ON m.DIRECTOR_ID = d.DIRECTOR_ID 
WHERE YEAR (d.DIRECTOR_BIRTH_DATE)>1980 
AND d.DIRECTOR_DEAD_DATE IS NULL
--19- Indica si hay alguna coincidencia de nacimiento de ciudad (y si las hay, indicarlas) entre los miembros de la plataforma y los directores
SELECT t1.*, t2.USER_TOWN
FROM DIRECTORS AS t1
INNER JOIN USERS AS t2 ON LOWER(t1.DIRECTOR_BIRTH_PLACE) = LOWER(t2.USER_TOWN)
--20- Devuelve el nombre y el año de todas las películas que han sido producidas por un estudio que actualmente no esté activo
SELECT m.MOVIE_NAME, 
YEAR (MOVIE_RELEASE_DATE)
FROM MOVIES m
JOIN STUDIOS s ON m.STUDIO_ID = s.STUDIO_ID
WHERE s.STUDIO_ACTIVE = 0
--21- Devuelve una lista de las últimas 10 películas a las que se ha accedido
SELECT m.MOVIE_NAME, ac.ACCESS_DATE
FROM USER_MOVIE_ACCESS ac
JOIN MOVIES m ON ac.MOVIE_ID = m.MOVIE_ID
ORDER BY ac.ACCESS_DATE DESC
LIMIT 10
--22- Indica cuántas películas ha realizado cada director antes de cumplir 41 años
SELECT d.DIRECTOR_NAME, COUNT (MOVIE_RELEASE_DATE) AS MOVIE_COUNT 
FROM MOVIES m 
JOIN DIRECTORS d ON d.DIRECTOR_ID = m.DIRECTOR_ID 
WHERE YEAR (m.MOVIE_RELEASE_DATE) - YEAR (d.DIRECTOR_BIRTH_DATE) < 41
GROUP BY d.DIRECTOR_NAME
ORDER BY d.DIRECTOR_NAME
--23- Indica cuál es la media de duración de las películas de cada director
SELECT d.DIRECTOR_NAME, AVG (MOVIE_DURATION) AS AVG_DURATION
FROM MOVIES m
JOIN DIRECTORS d ON m.DIRECTOR_ID = d.DIRECTOR_ID
GROUP BY d.DIRECTOR_NAME
ORDER BY d.DIRECTOR_NAME
--24- Indica cuál es la el nombre y la duración mínima de las películas a las que se ha accedido en los últimos 2 años por los miembros del plataforma (La “fecha de ejecución” de esta consulta es el 25-01-2019)
SELECT m.MOVIE_NAME, MIN (MOVIE_DURATION) AS MIN_DURATION
FROM MOVIES m
JOIN USER_MOVIE_ACCESS ac ON m.MOVIE_ID = ac.MOVIE_ID
JOIN USERS u ON ac.USER_ID = u.USER_ID
WHERE ac.ACCESS_DATE BETWEEN DATE '2017-01-25' AND DATE '2019-01-25'
GROUP BY m.MOVIE_NAME
ORDER BY m.MOVIE_NAME
--25- Indica el número de películas que hayan hecho los directores durante las décadas de los 60, 70 y 80 que contengan la palabra “The” en cualquier parte del título
SELECT d.DIRECTOR_NAME, COUNT (MOVIE_NAME)
FROM MOVIES m
JOIN DIRECTORS d ON m.DIRECTOR_ID = d.DIRECTOR_ID
WHERE LOWER (m.MOVIE_NAME) LIKE '%the%'
AND EXTRACT (YEAR FROM m.MOVIE_RELEASE_DATE) BETWEEN 1960 AND 1989
GROUP BY d.DIRECTOR_NAME
ORDER BY d.DIRECTOR_NAME